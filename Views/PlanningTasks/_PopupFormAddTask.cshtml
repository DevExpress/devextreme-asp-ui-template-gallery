@using DevExtremeVSTemplateMVC.Models
<link href="~/css/components/FormPopup.css" rel="stylesheet" />
<link href="~/css/components/TaskFormDetails.css" rel="stylesheet" />
<link href="~/css/components/FormTextBox.css" rel="stylesheet" />

@model EmployeeTask

@{
    var isEditing = true; // Set this from ViewBag or Model depending on mode
    var subjectField = true; // or false depending on your logic
}

@Html.DevExtreme().NamedTemplate("TaskDetailsForm", @<text>
    @(Html.DevExtreme().Form<EmployeeTask>()
        .ID("taskFormDetails")
        .ColCount(2)
        .ScreenByWidth("function(width) { return width < 768 ? 'xs' : 'md'; }")
        .FormData(Model)
        .ValidationGroup("formValidationGroup")
        .Items(items => {
            if (subjectField)
            {
                items.AddSimple()
                    .DataField("Text")
                    .ColSpan(2)
                    .Label(l => l.Text("Subject"))
                    .Editor(e => e.TextBox());
            }

            items.AddGroup()
                .ColCountByScreen(cs => cs
                    .Xs(1)
                    .Sm(2)
                    .Md(2)
                    .Lg(2))
                .Items(group => {
                    group.AddSimple().DataField("Company").CssClass("accent")
                        .Label(l => l.Text("Company"))
                        .Editor(e => e.TextBox().ReadOnly(!isEditing));

                    group.AddSimple().DataField("Owner").CssClass("accent")
                        .Label(l => l.Text("Assigned to"))
                        .Editor(e => e.TextBox().ReadOnly(!isEditing));

                    group.AddSimple().DataField("Priority")
                        .Label(l => l.Text("Priority"))
                        .Editor(e => e.SelectBox()
                            .Items(System.Enum.GetNames(typeof(PlanningTaskPriority)))
                            .ReadOnly(!isEditing)
                            .StylingMode(EditorStylingMode.Filled)
                        );

                    group.AddSimple().DataField("Status")
                        .Label(l => l.Text("Status"))
                        .Editor(e => e.SelectBox()
                            .Items(System.Enum.GetNames(typeof(PlanningTaskStatus)))
                            .ReadOnly(!isEditing)
                            .StylingMode(EditorStylingMode.Filled)
                        );

                    group.AddSimple().DataField("StartDate")
                        .Label(l => l.Text("Start Date"))
                        .Editor(e => e.DateBox()
                            .ReadOnly(!isEditing)
                            .DisplayFormat("yyyy-MM-dd")
                        );

                    group.AddSimple().DataField("DueDate")
                        .Label(l => l.Text("Due Date"))
                        .Editor(e => e.DateBox()
                            .ReadOnly(!isEditing)
                            .DisplayFormat("yyyy-MM-dd")
                        );
                });

            items.AddSimple().DataField("Description")
                .ColSpan(2)
                .Label(l => l.Text("Details"))
                .Editor(e => e.TextArea()
                    .ReadOnly(!isEditing)
                    .StylingMode(EditorStylingMode.Filled)
                );
        }))
</text>)

@(Html.DevExtreme().Popup()
    .ID("formPopup")
    .Title("New Task")
    .Visible(true)
    .Width(600)
    .Height("auto")
    .ShowCloseButton(true)
    .ShowTitle(true)
    .FullScreen(false)
    .WrapperAttr(new { @class = "form-popup" })
    .ContentTemplate("TaskDetailsForm")
    .ToolbarItems(toolbar => {
        toolbar.Add()
            .Location(ToolbarItemLocation.Center)
            .Toolbar(Toolbar.Bottom)
            .Template(@<text>
                <div class="form-popup-buttons-container">
                    @(Html.DevExtreme().Button()
                        .Text("Cancel")
                        .StylingMode(ButtonStylingMode.Outlined)
                        .ValidationGroup("formValidationGroup"))

                    @(Html.DevExtreme().Button()
                        .Text("Save")
                        .StylingMode(ButtonStylingMode.Contained)
                        .Type(ButtonType.Default)
                        .Disabled(false)
                        .ValidationGroup("formValidationGroup"))
                </div>
            </text>);
    }))
